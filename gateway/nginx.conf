worker_processes 1;
error_log stderr;
load_module /etc/nginx/modules/ngx_http_js_module.so;

events { 
    worker_connections 1024; 
}

http {
    # Rate limiting zones
    limit_req_zone $binary_remote_addr zone=api_general:10m rate=100r/m;
    limit_req_zone $binary_remote_addr zone=api_strict:10m rate=10r/m;
    limit_req_zone $binary_remote_addr zone=api_login:10m rate=5r/m;
    limit_req_zone $binary_remote_addr zone=api_public:10m rate=200r/m;

    # Connection limiting
    limit_conn_zone $binary_remote_addr zone=addr:10m;

    # DNS resolver
    resolver 127.0.0.11 valid=10s ipv6=off;

    # Rate limit error page
    map $status $rate_limit_message {
        429 '{"error": "Too many requests. Please try again later.", "status": 429}';
    }

    # Include server configurations
    include /etc/nginx/conf.d/*.conf;
}